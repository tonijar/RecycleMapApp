<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>New Web Project</title>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
		<!--[if lte IE 8]>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.ie.css" />
		<![endif]-->
		<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
		<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
		<script src="https://github.com/joker-x/Leaflet.geoCSV/blob/master/leaflet.geocsv.js"></script>
		<link rel="stylesheet" href="https://github.com/smeijer/L.GeoSearch/blob/master/src/css/l.geosearch.css" />
	</head>
	<body>
		<h1>New Web Project Page</h1>
		<input id="csv" type="hidden">
48.8566;2.3522;París, capital de Francia
40.4168;-3.7038;Madrid, capital de España
41.9015;12.4608;Roma, capital de Italia
37.9837;23.7293;Atenas, capital de Grecia
41.5409, 2.11598;Sabadell, capital del Valles Occidental</input>
		<div id="map" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"> </div>
		<script type="text/javascript">
			// Show map centered at current position.
			var map = L.map('map');
			map.locate({
				setView : true,
				maxZoom : 14
			})
			L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution : 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>',
				maxZoom : 18
			}).addTo(map);

			// Popup for positions
			var popup = L.popup();
			function onMapClick(e) {
				popup.setLatLng(e.latlng).setContent("You clicked the map at " + e.latlng.toString()).openOn(map);
			}
			map.on('click', onMapClick);

			// Wen current location successfully found --> add circle
			function onLocationFound(e) {
				L.circle(e.latlng, e.accuracy / 2).addTo(map);
			}
			map.on('locationfound', onLocationFound);

			// When current location fails --> alert message
			function onLocationError(e) {
				alert(e.message);
			}
			map.on('locationerror', onLocationError);

			var geo_csv = L.geoCsv(null,{
			  titles: ['lat', 'lng', 'popup'],
			  fieldSeparator: ';',
			  lineSeparator: '\n',
			  deleteDobleQuotes: true,
			  firstLineTitles: false,
			  onEachFeature: function (feature, layer) {
			    var popup = '';
			    for (var clave in feature.properties) {
			      var title = geo_csv.getPropertyTitle(clave);
			      popup += '<b>'+title+'</b><br />'+feature.properties[clave]+'<br /><br />';
			    }
			    layer.bindPopup(popup);
			  }
			});
			geo_csv.addData(document.getElementById('csv').value);
			map.addLayer(geo_csv);
		</script>
	</body>
</html>
